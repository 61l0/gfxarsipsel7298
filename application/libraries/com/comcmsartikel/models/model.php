<?phpclass Model extends CI_Model {    function __construct (){        parent::__construct();		$this->table_name = 'berita';	}	function simpan() {		$oper = $this->input->post('oper');		switch ($oper):		// ====================== penamabhan data ==============================		case 'add':		    			$this->doset();			if($this->db->insert($this->table_name)):					$this->responce = array('result'=>'succes','message'=>'Data berhasil ditambahkan','oper'=>'add');				$data = $this->db->get($this->table_name)->row();			    $this->responce['rows'] = @$data?$data:array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil ditambahkan','oper'=>'add');			endif;						break;		// ====================== pengeditan data ==============================		case 'edit':			$this->doset();			$this->db->where('id_berita',$this->input->post('id_berita'));			if($this->db->update($this->table_name)):				$this->responce = array('result'=>'succes','message'=>'Data berhasil diubah','oper'=>'edit');				$data = $this->db->get($this->table_name)->row();			    $this->responce['rows'] = @$data?$data:array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil diubah','oper'=>'edit');			endif;			break;		// ====================== penghapusan data ==============================		case 'del':			$this->removefile($this->input->post('id_berita'));			$this->db->where('id_berita',$this->input->post('id_berita'));			if($this->db->delete($this->table_name)):				$this->responce = array('result'=>'succes','message'=>'Data berhasil dihapus','oper'=>'del');				$this->responce['rows'] = array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil dihapus','oper'=>'del');			endif;			break;		// ====================== tidak ada oper ==============================		default:			$this->responce = array('result'=>'failed','message'=>'Cannot identify oper type','oper'=>$oper);		endswitch;		return $this->responce;	}	function doset(){		$urutan = $this->input->post('urutan');		$tanggal= $this->input->post('tanggal');		$this->db->set("id_menu",$this->input->post('id_menu'));		$this->db->set("judul",$this->input->post('judul'));		$this->db->set("sub_judul",$this->input->post('sub_judul'));		$this->db->set("tanggal",$tanggal);		$this->db->set("id_penulis",$this->input->post('id_penulis'));		// if(empty($urutan)):			// $urutan = $this->_setDefaultUrutan($tanggal);		// else:			// $urutan = $this->input->post('urutan');		// endif;		// $this->db->set("urutan", $urutan);		$this->db->set("status",$this->CI->input->post('status'));		$this->db->set("isi_berita",$this->input->post('isi_berita'));	}	function _setDefaultUrutan($tanggal){		if(empty($tanggal))$tanggal = date('Y-m-d');		$this->db->select_max('urutan');		$this->db->from('berita');		$this->db->where('tanggal', $tanggal);		$row = $this->db->get()->row();		if($row->urutan > 0){			$urutan = $row->urutan + 10;		}else{			$urutan = 10;		}		return $urutan;	}	function getdata($id=false){		$data = $this->db->where('id_berita',@$id)->get('berita')->row();		return @$data;	}	function saveupload(){		$id = $this->input->post("id_berita");		if(strlen($_FILES['pengumuman_file']['name'])>0){			if(empty($id))$id=0;			if(!empty($id)){				$this->db->select('*');				$this->db->from('berita');				$this->db->where('id_berita',$id);				$row = $this->db->get()->row();				$file_path = DOC_PATH_ROOT . 'assets/media/file/berita/';				$old_file = $file_path.$row->file;				if(is_file($old_file))unlink($old_file);			}			$result = $this->uploadFile($_FILES['pengumuman_file'],$id);			if($result['status']=='error'){				echo "error#".$result['error']."#".$result['id_berita']."#";			}else{				echo "success#none#".$result['id_berita']."#";			}		}else{			echo "error#Tidak ada file#0#";		}			}	function uploadFile($file=false,$id=false){		$this->load->helper('file');		$path2 = DOC_PATH_ROOT . 'assets/media/file/berita/';		MakeDir($path2);		$config['upload_path'] = DOC_PATH_ROOT . 'assets/media/file/berita';		$config['allowed_types'] = 'pdf|zip|rar|doc|docx|xls|xlsx';		$config['max_size']	= '2048';		$config['remove_spaces']=true;        $config['overwrite']    =true;		$this->load->library('upload', $config);		if ( ! $this->upload->do_upload('pengumuman_file'))		{			$data= array('status' => 'error', 'error' => $this->upload->display_errors());			return $data;		}			else		{			if($id > 0 ):				$this->db->set("file_attachment",$this->upload->file_name);				$this->db->where("id_berita",@$id);				$this->db->update("berita");			else:				$this->db->set("file_attachment",$this->upload->file_name);				$this->db->set("status",$this->input->post('status'));				$this->db->insert("berita");				$act = 'edit';				$id = $this->db->insert_id();				$this->session->set_userdata('act','edit');				$this->session->set_userdata('id_berita',$id);							endif;			$data = array('status'=>'success','error' =>'', 'id_berita' => $id);			return $data;		}	}	function removefile($id=false){		$this->db->select('*');		$this->db->from('berita');		$this->db->where('id_berita',$id);		$row = $this->db->get()->row();		$file_path = 'assets/media/file/berita/';		$file = $file_path.$row->file;		if(is_file($file))unlink($file);		$this->db->set("file",'');		$this->db->where("id_berita",$id);		$this->db->update("berita");		}	function urutan($oper=false,$id_berita=false,$urutan=false,$id_menu=false){		$urutan_new = '';		if($oper=="turun"){			$urutan_new = $urutan + 10;		}else{			$urutan_new = $urutan - 10;		}		// data self		$this->db->where('urutan',$urutan);		$this->db->where('id_menu',$id_menu);		$id_self = $this->db->get($this->table_name)->row()->id_berita;		// data will replaced		$this->db->where('urutan',$urutan_new);		$this->db->where('id_menu',$id_menu);		$id_replace = $this->db->get($this->table_name)->row()->id_berita;				$this->db->set('urutan',$urutan_new);		$this->db->where('id_berita',$id_self);		$up1 = $this->db->update($this->table_name);		$this->db->set('urutan',$urutan);		$this->db->where('id_berita',$id_replace);		$up2 = $this->db->update($this->table_name);				// if($up1 && $up2){		    // $this->db->select('*');		    // return $this->db->where('tanggal',$tanggal)->order_by('urutan')->get($this->table_name)->result();		// }	}	function optrubrik($id_rubrik=false,$session=false){		$this->db->select('a.*,b.id_rubrik');		$this->db->join('c_rubrik_acl b','a.id_menu = b.id_rubrik');		$this->db->join('public_component c','a.id_component = c.id_component');		$this->db->where('b.id_group',@$session);		$this->db->where('b.tipe','artikel');		$this->db->where('c.component_name','artikel');		$this->db->order_by('a.menu_name','asc');		$data = $this->db->get('public_menu a')->result();		$hasil = array();		$hasil['arr'][''] = 'Pilih';		foreach($data as $row):			if($row->id_menu == @$id_rubrik){$hasil['default'] = $row->id_menu;}			$hasil['arr'][$row->id_menu] = $row->menu_name;		endforeach;		return $hasil;	}	function optpenulis($id_penulis=false){		$this->db->select('a.id_penulis,a.nama_penulis');		$this->db->order_by('a.nama_penulis','asc');		$data = $this->db->get('berita_penulis a')->result();		$hasil = array();		foreach($data as $row):			if($row->id_penulis == $id_penulis){$hasil['default'] = $row->id_penulis;}			$hasil['arr'][$row->id_penulis] = $row->nama_penulis;		endforeach;		// dump($hasil);		return $hasil;	}}?>