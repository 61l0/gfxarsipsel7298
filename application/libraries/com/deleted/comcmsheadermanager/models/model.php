<?phpclass Model extends CI_Model {    function __construct (){        parent::__construct();		$this->table_name = 'public_header';	}	function simpan() {		$oper = $this->input->post('oper');		$id_header = $this->input->post('id_header');		$urutan = $this->input->post('urutan');		if(empty($urutan))$urutan=$this->_getAutoUrutan();		switch ($oper):		// ====================== penamabhan data ==============================		case 'add':		    			if($this->input->post('status') == 'on'){				$this->db->set("status",'off');				$this->db->update("public_header");			}			$this->db->set("header_link",$this->input->post('header_link'));			$this->db->set("status",$this->input->post('status'));			$this->db->set("urutan",$urutan);			if($this->db->insert($this->table_name)):					$this->responce = array('result'=>'succes','message'=>'Data berhasil ditambahkan','oper'=>'add');				$data = $this->db->get($this->table_name)->row();			    $this->responce['rows'] = @$data?$data:array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil ditambahkan','oper'=>'add');			endif;						break;		// ====================== pengeditan data ==============================		case 'edit':			if($this->input->post('status') == 'on'){				$this->db->set("status",'off');				$this->db->update("public_header");			}			$this->db->set("header_link",$this->input->post('header_link'));			$this->db->set("status",$this->input->post('status'));			$this->db->set("urutan",$urutan);			$this->db->where('id_header',@$id_header);			if($this->db->update($this->table_name)):				$this->responce = array('result'=>'succes','message'=>'Data berhasil diubah','oper'=>'edit');				$data = $this->db->get($this->table_name)->row();			    $this->responce['rows'] = @$data?$data:array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil diubah','oper'=>'edit');			endif;			break;		// ====================== penghapusan data ==============================		case 'del':			$this->db->where('id_header',@$id_header);			if($this->db->delete($this->table_name)):				$this->responce = array('result'=>'succes','message'=>'Data berhasil dihapus','oper'=>'del');				$this->responce['rows'] = array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil dihapus','oper'=>'del');			endif;			break;		case 'config':			$this->db->set("banner_effect",$this->input->post('banner_effect'));			$this->db->set("banner_width",$this->input->post('banner_width'));			$this->db->set("banner_height",$this->input->post('banner_height'));			$this->db->set("banner_strips",$this->input->post('banner_strips'));			$this->db->set('banner_delay',@$this->input->post('banner_delay'));			$this->db->set('banner_position',@$this->input->post('banner_position'));			$this->db->set('banner_direction',@$this->input->post('banner_direction'));			$this->db->where('id_config',$this->input->post('id_config'));			if($this->db->update('public_header_config')):				$this->responce = array('result'=>'succes','message'=>'Data berhasil diubah','oper'=>'edit');				$data = $this->db->get($this->table_name)->row();			    $this->responce['rows'] = @$data?$data:array();			else:				$this->responce = array('result'=>'failed','message'=>'Data tidak berhasil diubah','oper'=>'edit');			endif;			break;		case 'refresh':			$status = $this->db->select('status')->where('id_header',@$id_header)->get($this->table_name)->row()->status;			if($status=='off'){				$this->db->set("status",'off');				$this->db->update("public_header");				$status ='on';			}else{				$status ='off';			}			$this->db->set('status',@$status);			$this->db->where('id_header',@$id_header);			if($this->db->update($this->table_name)):				$this->responce = array('result'=>'succes','message'=>'Data status berhasil ubah','oper'=>'del');				$this->responce['rows'] = array();			else:				$this->responce = array('result'=>'failed','message'=>'Data status berhasil ubah','oper'=>'del');			endif;			break;		// ====================== tidak ada oper ==============================		default:			$this->responce = array('result'=>'failed','message'=>'Cannot identify oper type','oper'=>$oper);		endswitch;		return $this->responce;	}	function getdata($id=false){		$data = $this->db->where('id_header',@$id)->get('public_header')->row();		return @$data;	}	function saveupload(){		$id = $this->input->post("id_header");		if(strlen($_FILES['header_file']['name'])>0){			if(empty($id))$id=0;			if(!empty($id)){				$this->db->select('*');				$this->db->from('public_header');				$this->db->where('id_header',$id);				$row = $this->db->get()->row();				$file_path = DOC_PATH_ROOT . 'assets/media/file/header/';				$old_file = $file_path.$row->header_image;				if(is_file($old_file))unlink($old_file);			}			$result = $this->uploadFile($_FILES['header_file'],$id);			if($result['status']=='error'){				echo "error#".$result['error']."#".$result['id_header']."#";			}else{				echo "success#none#".$result['id_header']."#";			}		}else{			echo "error#Tidak ada file#0#";		}							}	function uploadFile($file=false,$id=false){		$this->load->helper('file');		$config['upload_path'] = DOC_PATH_ROOT . 'assets/media/file/header/';		$config['allowed_types'] = 'jpg|png|gif|bmp|jpeg';		$config['max_size']	= '2048';		$config['remove_spaces']=true;        $config['overwrite']    =true;		$this->load->library('upload', $config);		if ( ! $this->upload->do_upload('header_file'))		{			$data= array('status' => 'error', 'error' => $this->upload->display_errors());			return $data;		}			else		{			if(!empty($id)):				$this->db->set("header_image", $this->upload->file_name);				$this->db->where("id_header", $id);				$this->db->update("public_header");			else:				$this->db->set("header_image", $this->upload->file_name);				$this->db->insert("public_header");				$id = $this->db->insert_id();			endif;			$data = array('status'=>'success','error' =>'', 'id_header' => $id);			return $data;		}	}	function removeimage($id=false){		$this->db->select('*');		$this->db->from('public_header');		$this->db->where('id_header', $id);		$row = $this->db->get()->row();		$file_path = 'assets/media/file/header/';		$file = $file_path.$row->header_image;		if(is_file($file))unlink($file);		$this->db->set("header_image",'');		$this->db->where("id_header",$id);		$this->db->update("public_header");		}	function _getAutoUrutan(){		$this->db->select_max('urutan', 'max');		$row = $this->db->get('public_header')->row_array();		$new_index = 10;		if(!empty($row)):			$new_index = $row['max'] + 10;			return $new_index;		else:			return $new_index;		endif;	}	function headerconfig(){		$this->db->select('*');		$this->db->from('public_header_config');		$row = $this->db->get()->row_array();		return @$row;	}}?>